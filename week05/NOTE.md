# # 每周总结可以写在这里

本周主要是浏览器的HTTP协议这块内容

## 浏览器一个HTTP请求的过程

当我们在浏览器地址栏输入网址 ，然后回车, 这个请求过程中的一系列流程如下：

1. 浏览器查看缓存，如果请求的内容在缓存之中并且是在存活时限之内就会执行响应。
  
2. 浏览器会向操作系统询问该请求对应的IP地址，操作系统开始寻找域名对应的IP地址并最终返回给浏览器。系统查找IP地址，一般先查看浏览器的缓存，如果缓存中没有请求域名对应的IP地址，就会去查找在本地的host文件中是否存在对应的IP，如果还找不到就会询问DNS服务器。
  
3. 浏览器开始建立与服务器的TCP连接
  HTTP的底层是依靠TCP来通信的，所以简单介绍一些TCP／IP协议：TCP/IP 协议族里重要的一点就是分层。TCP/IP 协议族按层次分别分为以下 4 层：应用层、传输层、网络层和数据链路层。

  > 应用层：应用层决定了向用户提供应用服务时通信的活动（如FTP，DNS，HTTP）。
  
  > 传输层：传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。在传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议和 UDP（User Data Protocol，用户数据报协议）
  
  > 网络层：网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。
  > 链路层：用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动NIC（Network Interface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在链路层的作用范围之内。

4. 浏览器通过TCP连接发送HTTP请求
  TCP连接建立后就可以开始发送HTTP报文了，由于底层通信使用了TCP/IP协议，因此HTTP报文在客户端会被层层包装添加TCP/IP协议中每一层的首部信息，直到被包装后的请求内容到达服务器端。服务器端接收到信息后又会逆向层层解包直到得到原本的HTTP报文。

4. 服务器接收到请求后对请求做出处理，然后返回HTTP response。
  一般来说，服务器接收到请求会根据请求的路径寻找一个可以处理该请求的程序。用MVC框架来解释就是：根据请求的路径找到对应处理请求的controller，之后控制器会调用业务逻辑处理请求，然后返回一个Model，之后通过视图解析器的包装最终变成一个response然后通过已经建立好的TCP连接以同样的传输方式返回给浏览器。

6. 浏览器接收到HTTP响应，选择关闭TCP连接，或者继续维持等待下一次请求的发生如果选择关闭连接，会进行TCP的四次挥手
  第一次挥手：主机1（可以使客户端，也可以是服务器端），设置Sequence Number，向主机2发送一个FIN报文段；此时，主机1进入FIN_WAIT_1状态；这表示主机1没有数据要发送给主机2了；
  第二次挥手：主机2收到了主机1发送的FIN报文段，向主机1回一个ACK报文段，Acknowledgment Number为Sequence Number加1；主机1进入FIN_WAIT_2状态；主机2告诉主机1，我“同意”你的关闭请求；
  第三次挥手：主机2向主机1发送FIN报文段，请求关闭连接，同时主机2进入LAST_ACK状态；
  第四次挥手：主机1收到主机2发送的FIN报文段，向主机2发送ACK报文段，然后主机1进入TIME_WAIT状态；主机2收到主机1的ACK报文段以后，就关闭连接；此时，主机1等待2MSL后依然没有收到回复，则证明Server端已正常关闭，那好，主机1也可以关闭连接了。

7. 浏览器检查收到的响应的状态码
    浏览器检查响应是否是一个重定向响应或者是一个需要特殊处理的响应(3xx的状态码)，或者是需要重新认证(401状态码)，或者错误(4xx和5xx状态码)等；浏览器会和正常的响应(2xx)相区别并作出不同的应对。
    
8. 如果缓存是可用的，响应会被放入缓存
9. 浏览器对响应进行解码(通常使用gzip)
10. 浏览器真正决定如何处理这个响应
  判断响应是什么文件，比如是HTML页面或者是图片，又或者是声音文件。如果是页面，浏览器会渲染并呈现给用户，又或者是提供认证或者是下载的窗口等，取决于浏览器收到了什么类型的响应。

